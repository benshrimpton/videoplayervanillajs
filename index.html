<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="custom-video-player">  
  <video  
    loop
    src="https://www.sirdavis.com/sites/default/files/2024-09/SIRDAVIS_BRAND_EDIT_20240828_MC_FINAL_16x9_H264_Website.mp4"
    style="width: 100%;"
    class="js-video-plays-in-view">
  </video>

  <div class="custom-video-player__controls">

    <button class="custom-video-player__playPauseBtn paused">
      <span class="custom-video-player__playPauseBtn--play">
        <span class="sr-only">play</span>
        <svg width="27" height="24" viewBox="0 0 27 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_227_410)">
        <path d="M6.16516 23.6769C4.45178 24.5909 2.25916 23.4939 2.25916 21.7099L2.25916 2.29591C2.25916 0.511914 4.45179 -0.585086 6.16516 0.328914L24.3677 10.0379C26.036 10.9289 26.0327 13.0789 24.3677 13.9679L6.16516 23.6769Z" fill="white"/>
        </g>
        <defs>
        <clipPath id="clip0_227_410">
        <rect width="24" height="27" fill="white" transform="translate(27) rotate(90)"/>
        </clipPath>
        </defs>
        </svg>
      </span>
      <span class="custom-video-player__playPauseBtn--pause">
        <span class="sr-only">Pause</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
        >
          <path
            d="M11 22h-4v-20h4v20zm6-20h-4v20h4v-20z"" fill="
            white"
          />
        </svg>
      </span>
    </button>
    <progress
      class="custom-video-player__progressBar"
      type="pro"
      value="0"
      max="100"
    ></progress>
    <!-- <input
      class="custom-video-player__progressBar"
      type="pro"
      value="0"
      max="100"
    /> -->
    <span class="custom-video-player__currentTime">0:00</span>
    <button class="custom-video-player__muteBtn">Mute</button>
    <div class="custom-video-player__volumeBar-wrap">
      <input
        class="custom-video-player__volumeBar"
        type="range"
        min="0"
        max="1"
        step="0.1"
        value="0"
      />
    </div>
    <button class="custom-video-player__fullscreenBtn">Fullscreen</button>
  </div>
</div>
<style>
  body {
    margin: 0;
    pad: 0;
  }
  .sr-only {
    display: none;
  }

  .custom-video-player {
    font-family: sans-serif;
    position: relative;
    /* width: 640px;
    height: 264px; */
    background-color: black;
    color: white;
    aspect-ratio: 16 / 9;
    font-size: 13px;
    font-family: monospace;

  }

  @media (max-width: 640px) {
    .custom-video-player {
      aspect-ratio: 9 / 16;
    }
  }

  .js-video-plays-in-view {
    width: 100%;
    height: 100%;
  }

  .custom-video-player__controls {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    /* background: rgba(0, 0, 0, 0.7); */
    display: flex;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
    opacity: 0;
    transition: opacity ease .3s;
  }
  .custom-video-player:hover .custom-video-player__controls {
    opacity: 1;
  }  

  .custom-video-player__controls button {
    margin-right: 10px;
    color: white;
    background: transparent;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 30px;
  }

  .custom-video-player__fullscreenBtn {
    display: none !important;
  }
  .custom-video-player__muteBtn {
    /* Hide for Sir */
    display: none !important;
  }
  .custom-video-player__progressBar {
    flex-grow: 1;
    height: 3px;
    background-color: #979797;
    overflow: hidden;
    border-radius: 999px;
  }

  .custom-video-player__progressBar::-webkit-progress-bar {
    height: 3px;
    background-color: #979797;
  }

  .custom-video-player__progressBar::-webkit-progress-value {
    background-color: white;
    border-radius: 0;
    border-radius: 999px;
  }


  /* /volumnes */
    .custom-video-player__volumeBar-wrap {
      position: relative;
    }
  .custom-video-player__volumeBar {
    height: 15px;
    -webkit-appearance: none;
    appearance: none;
    background-color: transparent;
    overflow: hidden;
    margin: 0;
  }

  .custom-video-player__volumeBar::-webkit-slider-runnable-track {
    background-color: #979797;
    height: 3px;
    border-radius: 999px;
  }

  .custom-video-player__volumeBar::-webkit-slider-thumb {
    background-color: white;
    appearance: none;
    display: block;
    height: 8px;
    width: 8px;
    border-radius: 999px;
    position: relative;
    top: -2px;
    /* box-shadow: -407px 0 0 400px #fff; */
  }

  .custom-video-player__volumeBar {
    width: 100px;
  }

  .custom-video-player__currentTime {
    color: white;
    margin: 0 2rem 0 1rem;
  }

  .custom-video-player__playPauseBtn svg {
    height: 18px;
    width: auto;
  }
  .custom-video-player__playPauseBtn.playing .custom-video-player__playPauseBtn--play {
    display: block;
  }

  .custom-video-player__playPauseBtn.paused .custom-video-player__playPauseBtn--play {
    display: none;
  }

  .custom-video-player__playPauseBtn.playing .custom-video-player__playPauseBtn--pause {
    display: none;
  }

  .custom-video-player__playPauseBtn.paused .custom-video-player__playPauseBtn--pause {
    display: block;
  }
  .range__input-fill {
    left: 0;
    pointer-events: none;
    position: absolute;
    height: 10px;
    background-color: white;
    display: block;
    height: 3px;
    top:35%;
    border-top-left-radius: 999px;
    border-bottom-left-radius: 999px;
    transition: translateY(-50%);
  }
</style>

<script>
  const playPauseVideosInView = () => {
    const videos = document.querySelectorAll('.js-video-plays-in-view');
    videos.forEach((video) => {
      // We can only control playback without insteraction if video is muted
      video.muted = true;
      // Play is a promise so we need to check we have it
      let playPromise = video.play();
      if (playPromise !== undefined) {
        playPromise.then((_) => {
          let observer = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.intersectionRatio <= 0.1 && !video.paused) {
                  video.pause();
                  // console.log("video pause");
                } else if (video.paused) {
                  // set to half a second so that if it goes out of view again doesnt hammer the bandwidth
                  setTimeout(function () {
                    video.play();
                  }, 500);
                }
              });
            },
            { threshold: 0.1 },
          );

          observer.observe(video);
        });
      }
    });
  };


  function initCustomVideoSkin() {


    const videoPlayers = document.querySelectorAll(".custom-video-player");

    videoPlayers.forEach(player => {
      const video = player.querySelector("video");
      const playPauseBtn = player.querySelector(".custom-video-player__playPauseBtn");
      const progressBar = player.querySelector(".custom-video-player__progressBar");
      const muteBtn = player.querySelector(".custom-video-player__muteBtn");
      const volumeBarWrap = player.querySelector(".custom-video-player__volumeBar-wrap");
      const volumeBar = player.querySelector(".custom-video-player__volumeBar");
      
      const fullscreenBtn = player.querySelector(".custom-video-player__fullscreenBtn");
      const currentTimeDisplay = player.querySelector(".custom-video-player__currentTime");


      // range fill, place the <input> and fill inside container <span>
      let rangeFill = document.createElement("span");
      rangeFill.className = "range__input-fill";
      // volumeBar.appendChild(this.el);
      volumeBarWrap.appendChild(rangeFill);
      // this.fill = rangeFill;


      // Play/Pause button
      playPauseBtn.addEventListener("click", function () {
        if (video.paused) {
          video.play();
          playPauseBtn.classList.remove('paused')
          playPauseBtn.classList.add('paused')
        } else {
          video.pause();
          playPauseBtn.classList.remove('paused')
          playPauseBtn.classList.add('playing')
        }
      });

      // Update progress bar and current time display as the video plays
      video.addEventListener("timeupdate", function () {
        const progress = (video.currentTime / video.duration) * 100;
        progressBar.value = progress;
        currentTimeDisplay.textContent = formatTime(video.currentTime);
      });

      // Seek video when progress bar is changed
      progressBar.addEventListener("input", function () {
        const seekTime = (progressBar.value / 100) * video.duration;
        video.currentTime = seekTime;
      });

      // Mute/Unmute button
      muteBtn.addEventListener("click", function () {
        video.muted = !video.muted;
        muteBtn.textContent = video.muted ? "Unmute" : "Mute";
      });

      // Volume control
      volumeBar.addEventListener("input", function () {
        console.log(volumeBar.value)
        rangeFill.style.width = volumeBar.value * 100 + '%'
        if(volumeBar.value > 0) {
          console.log("greater")
          video.muted = false
        }
        else {
          console.log("less")
          video.muted = true
        }
        video.volume = volumeBar.value;
      });

      // Fullscreen button
      fullscreenBtn.addEventListener("click", function () {
        if (video.requestFullscreen) {
          video.requestFullscreen();
        } else if (video.mozRequestFullScreen) {
          video.mozRequestFullScreen();
        } else if (video.webkitRequestFullscreen) {
          video.webkitRequestFullscreen();
        } else if (video.msRequestFullscreen) {
          video.msRequestFullscreen();
        }
      });

      // Format time (seconds to mm:ss)
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
      }

      // Set initial current time display
      video.addEventListener("loadedmetadata", function () {
        currentTimeDisplay.textContent = formatTime(video.duration);
      });
    });
  }

  playPauseVideosInView()
  initCustomVideoSkin()
</script>
</body>
</html>